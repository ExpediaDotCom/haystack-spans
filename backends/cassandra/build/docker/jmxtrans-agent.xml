<jmxtrans-agent>
    <queries>
        <query objectName="metrics:name=elasticsearch.read.time" attributes="99thPercentile,50thPercentile,OneMinuteRate" resultAlias="elasticsearch.read.time.#attribute#"/>
        <query objectName="metrics:name=elasticsearch.read.failures" attributes="OneMinuteRate" resultAlias="elasticsearch.read.failures.#attribute#"/>
        <query objectName="metrics:name=com.expedia.www.haystack.trace.storage.backends.cassandra.read.time" attributes="99thPercentile,50thPercentile,OneMinuteRate" resultAlias="com.expedia.www.haystack.trace.storage.backends.cassandra.read.time.#attribute#"/>
        <query objectName="metrics:name=com.expedia.www.haystack.trace.storage.backends.cassandra.read.failures" attributes="OneMinuteRate" resultAlias="com.expedia.www.haystack.trace.storage.backends.cassandra.read.failures.#attribute#"/>
        <query objectName="metrics:name=search.trace.rejected" attributes="OneMinuteRate" resultAlias="trace-search.rejected.#attribute#"/>
        <query objectName="metrics:name=com.expedia.www.haystack.trace.storage.backends.cassandra.traces.failures" attributes="OneMinuteRate" resultAlias="com.expedia.www.haystack.trace.storage.backends.cassandra.traces.failures.#attribute#"/>

    <!-- cassandra metrics coming from driver-->
    <query objectName="cassandra-cluster-metrics:name=connection-errors" attribute="Count" resultAlias="cassandra.errors.count"/>
    <query objectName="cassandra-cluster-metrics:name=read-timeouts" attribute="Count" resultAlias="cassandra.read-timeouts.count"/>
    <query objectName="cassandra-cluster-metrics:name=client-timeouts" attribute="Count" resultAlias="cassandra.client-timeouts.count"/>
    <query objectName="cassandra-cluster-metrics:name=requests" attribute="OneMinuteRate" resultAlias="cassandra.requests.rate"/>
    <query objectName="cassandra-cluster-metrics:name=requests" attribute="99thPercentile" resultAlias="cassandra.requests.99thPercentile"/>
    <query objectName="cassandra-cluster-metrics:name=write-timeouts" attribute="Count" resultAlias="cassandra.write-timeouts.count"/>
    <query objectName="cassandra-cluster-metrics:name=open-connections" attribute="Value" resultAlias="cassandra.open-connections.value"/>
    <query objectName="cassandra-cluster-metrics:name=other-errors" attribute="Count" resultAlias="cassandra.other-errors.count"/>


    <outputWriter class="org.jmxtrans.agent.GraphitePlainTextTcpOutputWriter">
        <!-- template used in influxdb : "haystack.* system.subsystem.application.host.class.measurement*" -->
        <host>${HAYSTACK_GRAPHITE_HOST:monitoring-influxdb-graphite.kube-system.svc}</host>
        <port>${HAYSTACK_GRAPHITE_PORT:2003}</port>
        <enabled>${HAYSTACK_GRAPHITE_ENABLED:true}</enabled>
        <namePrefix>haystack.traces.reader.#hostname#.</namePrefix>
    </outputWriter>
    <collectIntervalInSeconds>30</collectIntervalInSeconds>
</jmxtrans-agent>
